<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CG Project Report Viewer</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="bg"></div>
    <header class="topbar">
      <div class="brand">
        <div class="logo">CG</div>
        <div class="title">
          <div class="name">Project Report Viewer</div>
          <div class="subtitle">Agents, tools, batches, and OTel durations</div>
        </div>
      </div>
      <div class="actions">
        <select id="projectSelect" class="select" title="Select project">
          <option value="">Select Project</option>
        </select>
        <button id="btnLoadApi" class="btn" type="button" title="Generate and load report from API">
          Load Project
        </button>
        <label class="btn" for="fileInput">Load JSON</label>
        <input id="fileInput" type="file" accept="application/json,.json" />
        <button id="btnDemo" class="btn btn-ghost" type="button" title="Load a small built-in example schema">
          Load Example
        </button>
      </div>
    </header>

    <main class="layout" id="dropZone">
      <section class="left">
        <div class="panel panel-canvas">
          <div class="panel-head">
            <div class="panel-title">Relationship Graph</div>
            <div class="panel-controls">
              <input id="search" class="input" placeholder="Search agent/tool_call/batch id..." />
              <select id="edgeFilter" class="select" title="Edge filter">
                <option value="all">All edges</option>
                <option value="agent_creates_agent">agent -> agent</option>
                <option value="agent_calls_tool">agent -> tool_call</option>
                <option value="tool_call_creates_batch">tool_call -> batch</option>
                <option value="agent_creates_batch">agent -> batch</option>
                <option value="batch_contains_agent">batch -> agent</option>
              </select>
              <button id="btnZoomOut" class="btn btn-ghost" type="button" title="Zoom out">-</button>
              <button id="btnZoomIn" class="btn btn-ghost" type="button" title="Zoom in">+</button>
              <button id="btnFit" class="btn btn-ghost" type="button">Fit</button>
            </div>
          </div>
          <canvas id="graph" width="1200" height="800"></canvas>
          <div class="hint">
            Static layout. Drag nodes. Scroll or +/- to zoom. Drag background to pan. Click to inspect.
          </div>
        </div>

        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">Timeline (LLM Calls)</div>
            <div class="panel-sub">From report `otel.index_by_trace_id.*.llm_calls`</div>
          </div>
          <div id="llmTimeline" class="table"></div>
        </div>

        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">Tool Calls</div>
            <div class="panel-sub">From CardBox + OTel durations in the report</div>
          </div>
          <div id="toolTable" class="table"></div>
        </div>
      </section>

      <aside class="right">
        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">Summary</div>
            <div class="panel-sub" id="summarySub">Drop a report JSON to begin.</div>
          </div>
          <div id="summary" class="summary"></div>
        </div>

        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">Selection</div>
            <div class="panel-sub">Click a node or edge to see details.</div>
          </div>
          <div id="selectionMeta" class="kv"></div>
          <pre id="selectionJson" class="code"></pre>
        </div>

        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">Cards</div>
            <div class="panel-sub">Tool cards embedded in the report (`cards.cards_by_id`).</div>
          </div>
          <div class="panel-controls" style="padding: 0 14px 12px;">
            <input id="cardSearch" class="input" placeholder="Search card_id / type / tool_call_id..." />
          </div>
          <div id="cards" class="cards"></div>
        </div>
      </aside>
    </main>

    <footer class="footer">
      <div class="drop">
        Tip: drag-and-drop your `*.report.json` anywhere on the page.
      </div>
    </footer>

    <script src="./viewer.js"></script>
  </body>
</html>
